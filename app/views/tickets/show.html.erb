<h1><%= @ticket.subject %></h1>

<p><strong>Status:</strong> <%= @ticket.status %></p>
<p><strong>Priority:</strong> <%= @ticket.priority %></p>
<p><strong>Requester:</strong> <%= @ticket.requester.display_name %></p>
<p><strong>Assignee:</strong> <%= @ticket.assignee&.display_name || 'Unassigned' %></p>
<p><strong>Category:</strong> <%= @ticket.category %></p>
<p><strong>Description:</strong></p>
<p><%= @ticket.description %></p>

<% if policy(@ticket).assign? %>
  <%= form_with url: assign_ticket_path(@ticket), method: :post do |form| %>
    <%= form.label :agent_id, 'Assign to:' %>
    <%= form.select :agent_id, User.where(role: :agent).collect { |u| [u.display_name, u.id] }, include_blank: true %>
    <%= form.submit 'Assign' %>
  <% end %>
<% end %>

<%= link_to 'Edit', edit_ticket_path(@ticket) if policy(@ticket).edit? %>
<%= link_to 'Back', tickets_path %>